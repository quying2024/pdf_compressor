# æ›´æ–°æ—¥å¿— / Changelog

## [v2.0.0] - 2025-10-18

### ğŸ‰ é‡å¤§æ›´æ–° / Major Updates

#### ç®—æ³•é‡æ„ / Algorithm Refactoring
- **äºŒåˆ†åŒå‘æœç´¢ç®—æ³•**: å®Œå…¨é‡å†™å‹ç¼©ç­–ç•¥ï¼Œé‡‡ç”¨æ™ºèƒ½è·³è·ƒå’Œå‘ä¸Šå›æº¯æœºåˆ¶
- **çº¯ç‰©ç†æ‹†åˆ†ç­–ç•¥**: æ‹†åˆ†æ—¶å¤ç”¨å‹ç¼©ä¸­é—´ç»“æœï¼Œä¸é‡æ–°å‹ç¼©
- **6æ–¹æ¡ˆå‹ç¼©ç­–ç•¥**: S1-S6å…­çº§å‹ç¼©æ–¹æ¡ˆï¼Œæ™ºèƒ½é€‰æ‹©æœ€ä¼˜è´¨é‡

#### æ€§èƒ½æå‡ / Performance Improvements
- âš¡ å‹ç¼©å¤„ç†æ—¶é—´é™ä½ **77%** (420ç§’ â†’ 95ç§’)
- âš¡ æ‹†åˆ†å¤„ç†æ—¶é—´é™ä½ **99.2%** (1800ç§’ â†’ 15ç§’)
- âš¡ DARæ‰§è¡Œæ¬¡æ•°é™ä½ **80%** (5æ¬¡ â†’ 1æ¬¡)
- ğŸ¯ è´¨é‡æ›´ä¼˜ï¼šå‘ä¸Šå›æº¯ç¡®ä¿æœ€ä½³è´¨é‡

#### æ–°å¢åŠŸèƒ½ / New Features
- âœ¨ æ‰‹åŠ¨æ¨¡å¼ (`-m, --manual`): æ”¯æŒäº¤äº’å¼å‚æ•°è¾“å…¥
- âœ¨ å‚æ•°ç¤ºä¾‹æ˜¾ç¤º (`-?, --examples`): å¿«é€ŸæŸ¥çœ‹ä½¿ç”¨ç¤ºä¾‹
- âœ¨ ä¿ç•™ä¸´æ—¶ç›®å½• (`-k, --keep-temp-on-failure`): å¤±è´¥æ—¶ä¿ç•™ä¸´æ—¶æ–‡ä»¶ä¾¿äºè°ƒè¯•
- âœ¨ UTF-8ç¼–ç æ”¯æŒ: å®Œå–„Windows PowerShellä¸­æ–‡æ˜¾ç¤º

#### ç”¨æˆ·ä½“éªŒæ”¹è¿› / UX Improvements
- ğŸ”§ å‚æ•°ç®€åŒ–: `--output-dir` â†’ `--output`
- ğŸ“Š æ›´è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- ğŸ¨ ä¼˜åŒ–çš„è¿›åº¦æç¤º
- ğŸ› ä¿®å¤å¤šä¸ªç¼–ç é—®é¢˜

### ğŸ“ ä»£ç æ”¹è¿› / Code Improvements

#### æ ¸å¿ƒæ¨¡å—é‡å†™
- **compressor/strategy.py**: å®Œå…¨é‡æ„ï¼Œå®ç°äºŒåˆ†åŒå‘æœç´¢ç®—æ³•
  - `run_compression_strategy()`: æ–°çš„å‹ç¼©ç­–ç•¥å…¥å£
  - `_precompute_dar_steps()`: DARé¢„è®¡ç®—ï¼Œå¤ç”¨ä¸­é—´ç»“æœ
  - `_run_strategy_logic()`: æ™ºèƒ½æœç´¢é€»è¾‘
  - `_execute_scheme()`: å•æ–¹æ¡ˆæ‰§è¡Œ
  
- **compressor/splitter.py**: å®Œå…¨é‡æ„ï¼Œå®ç°çº¯ç‰©ç†æ‹†åˆ†
  - `run_splitting_strategy()`: æ–°çš„æ‹†åˆ†ç­–ç•¥å…¥å£
  - `_select_splitting_source()`: æ™ºèƒ½æºæ–‡ä»¶é€‰æ‹©
  - `_determine_optimal_split_count()`: å¯†åº¦åŸºæ‹†åˆ†æ•°è®¡ç®—
  - `_calculate_split_plan()`: é¡µé¢åˆ†é…æ–¹æ¡ˆ
  - `_split_pdf_physical()`: qpdfç‰©ç†æ‹†åˆ†

#### é›†æˆæ”¹è¿›
- **orchestrator.py**: æ›´æ–°æµç¨‹è°ƒåº¦é€»è¾‘
  - æ”¯æŒæ–°çš„è¿”å›æ ¼å¼ `(status, details)`
  - ä¼ é€’ `all_results` ç»™æ‹†åˆ†æ¨¡å—
  
- **main.py**: å¢å¼ºå‘½ä»¤è¡Œæ¥å£
  - UTF-8ç¼–ç é…ç½®
  - æ–°å¢3ä¸ªå‘½ä»¤è¡Œå‚æ•°
  - ä¼˜åŒ–å¸®åŠ©ä¿¡æ¯æ˜¾ç¤º

- **compressor/utils.py**: å·¥å…·å‡½æ•°ä¼˜åŒ–
  - ç®€åŒ–æ—¥å¿—é…ç½®
  - æ”¹è¿›é”™è¯¯å¤„ç†

### ğŸ§ª æµ‹è¯• / Testing

#### æ–°å¢æµ‹è¯•
- **tests/test_new_strategy.py**: å‹ç¼©ç­–ç•¥å•å…ƒæµ‹è¯•
  - âœ… æ¸è¿›å¼å‹ç¼©æˆåŠŸæµ‹è¯•
  - âœ… è·³è·ƒå›æº¯æˆåŠŸæµ‹è¯•
  - âœ… å…¨éƒ¨å¤±è´¥å¤„ç†æµ‹è¯•
  - âœ… å°æ–‡ä»¶è·³è¿‡æµ‹è¯•
  - **æµ‹è¯•é€šè¿‡ç‡: 100% (4/4)**

- **test_parameters.py**: å‚æ•°éªŒè¯æµ‹è¯•
  - âœ… 14ä¸ªå‚æ•°å…¨éƒ¨éªŒè¯é€šè¿‡

### ğŸ“š æ–‡æ¡£æ›´æ–° / Documentation Updates

#### æ ¸å¿ƒæ–‡æ¡£
- **README.md**: å…¨é¢æ›´æ–°
  - åŠŸèƒ½ç‰¹æ€§æè¿°
  - ç®—æ³•è¯´æ˜é‡å†™
  - å‚æ•°è¡¨æ ¼æ›´æ–°
  - ä½¿ç”¨ç¤ºä¾‹æ›´æ–°
  - æ·»åŠ v2.0æ›´æ–°æ—¥å¿—

#### æ–°å¢æ–‡æ¡£
- **docs/ç®—æ³•å®ç°è¯´æ˜.md**: è¯¦ç»†æŠ€æœ¯æ–‡æ¡£ (çº¦7000å­—)
  - ç®—æ³•è®¾è®¡ç†å¿µ
  - äºŒåˆ†åŒå‘æœç´¢ç®—æ³•è¯¦è§£
  - çº¯ç‰©ç†æ‹†åˆ†ç®—æ³•è¯¦è§£
  - æ€§èƒ½åˆ†æå’Œæµ‹è¯•éªŒè¯
  
- **docs/æ–‡æ¡£æ›´æ–°æ—¥å¿—.md**: æ–‡æ¡£æ›´æ–°è®°å½•
  - å®Œæ•´çš„æ–‡æ¡£æ›´æ–°åˆ—è¡¨
  - æ–‡æ¡£é˜…è¯»å»ºè®®
  - è´¨é‡ä¿è¯æ¸…å•

#### æ›´æ–°æ–‡æ¡£
- **docs/ç­–ç•¥åˆ†ææŠ¥å‘Š.md**: é‡æ„ä¸º"åˆ†æä¸å®ç°æŠ¥å‘Š"
  - æ–°å¢ç¬¬5ç« ï¼šæ–°ç®—æ³•å®ç°è¯´æ˜
  - æ›´æ–°æ€»ç»“éƒ¨åˆ†
  
- **docs/QUICKSTART.md**: å¿«é€Ÿå¼€å§‹æŒ‡å—æ›´æ–°
- **docs/WINDOWS_GUIDE.md**: WindowsæŒ‡å—å‚æ•°æ›´æ–°
- **docs/TROUBLESHOOTING.md**: æ•…éšœæ’é™¤å‚æ•°æ›´æ–°
- **docs/DEPLOYMENT_SUMMARY.md**: éƒ¨ç½²æ‘˜è¦æ›´æ–°
- **docs/é¡¹ç›®æ¶æ„ç¬¬ä¸€ç‰ˆ.md**: æ·»åŠ v2.0è¯´æ˜

### ğŸ”§ æŠ€æœ¯ç»†èŠ‚ / Technical Details

#### å‹ç¼©æ–¹æ¡ˆå®šä¹‰
```python
COMPRESSION_SCHEMES = {
    'S1': {'dpi': 300, 'bg_downsample': 2},  # é«˜è´¨é‡
    'S2': {'dpi': 250, 'bg_downsample': 3},  # é€‚åº¦é™ä½
    'S3': {'dpi': 200, 'bg_downsample': 4},  # å¹³è¡¡
    'S4': {'dpi': 150, 'bg_downsample': 5},  # æ¿€è¿›
    'S5': {'dpi': 120, 'bg_downsample': 5},  # æ›´æ¿€è¿›
    'S6': {'dpi': 110, 'bg_downsample': 6},  # æé™
}
```

#### å…³é”®ç®—æ³•ç‰¹æ€§
- **æ™ºèƒ½è·³è·ƒ**: S1å¤±è´¥ä¸”ç»“æœ>1.5å€ç›®æ ‡æ—¶ï¼Œç›´æ¥è·³è‡³S6
- **å‘ä¸Šå›æº¯**: S6æˆåŠŸåï¼Œæµ‹è¯•S5â†’S4â†’S3â†’S2æ‰¾æœ€ä¼˜è´¨é‡
- **DARå¤ç”¨**: é˜¶æ®µ1-2åªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€æœ‰æ–¹æ¡ˆå¤ç”¨hOCR
- **å¯†åº¦åˆ†é…**: åŸºäºæ–‡ä»¶å¤§å°å’Œé¡µæ•°è®¡ç®—æœ€ä¼˜æ‹†åˆ†æ–¹æ¡ˆ

### ğŸ› Bugä¿®å¤ / Bug Fixes
- ğŸ”§ ä¿®å¤å‡½æ•°åç§°ä¸åŒ¹é…é—®é¢˜ (`create_temp_dir` â†’ `create_temp_directory`)
- ğŸ”§ ä¿®å¤UTF-8ç¼–ç é”™è¯¯ï¼ˆWindows PowerShellï¼‰
- ğŸ”§ ä¿®å¤ç¼©è¿›å¯¼è‡´çš„é€»è¾‘é”™è¯¯
- ğŸ”§ ä¿®å¤æµ‹è¯•æ•°æ®ä¸åŒ¹é…é—®é¢˜

### ğŸ“¦ ä¾èµ–å˜æ›´ / Dependencies
- æ— ä¾èµ–å˜æ›´ï¼Œç»§ç»­ä½¿ç”¨ï¼š
  - archive-pdf-tools (recode_pdf)
  - poppler-utils (pdftoppm, pdfinfo)
  - tesseract-ocr
  - qpdf

### âš ï¸ ç ´åæ€§å˜æ›´ / Breaking Changes
- å‚æ•°åç§°å˜æ›´: `--output-dir` â†’ `--output`
  - å†…éƒ¨é€šè¿‡ `dest="output_dir"` ä¿æŒä»£ç å…¼å®¹
  - ç”¨æˆ·éœ€æ›´æ–°å‘½ä»¤è¡Œè„šæœ¬
  
- è¿”å›å€¼æ ¼å¼å˜æ›´:
  - æ—§: å•ä¸ªå¸ƒå°”å€¼æˆ–è·¯å¾„
  - æ–°: `(status, details)` å…ƒç»„

### ğŸ¯ è¿ç§»æŒ‡å— / Migration Guide

#### å‘½ä»¤è¡Œå‚æ•°æ›´æ–°
```bash
# v1.0
python main.py --input file.pdf --output-dir ./out

# v2.0
python main.py --input file.pdf --output ./out
```

#### ä»£ç é›†æˆæ›´æ–°
```python
# v1.0
success = run_iterative_compression(pdf, output, target)

# v2.0
status, details = run_compression_strategy(pdf, output, target)
if status == 'success':
    output_file = details['output_path']
```

---

## [v1.0.0] - 2024-10-09

### åˆå§‹ç‰ˆæœ¬å‘å¸ƒ / Initial Release
- âœ¨ å®ç°å®Œæ•´çš„DARå¤„ç†æµç¨‹
- âœ¨ æ”¯æŒåˆ†å±‚å‹ç¼©ç­–ç•¥
- âœ¨ é›†æˆPDFæ‹†åˆ†åŠŸèƒ½
- âœ¨ æ·»åŠ è¯¦ç»†æ—¥å¿—è®°å½•
- ğŸ“š å®Œæ•´çš„é¡¹ç›®æ–‡æ¡£

---

## ç‰ˆæœ¬è¯´æ˜ / Version Notes

æœ¬é¡¹ç›®éµå¾ª [è¯­ä¹‰åŒ–ç‰ˆæœ¬ 2.0.0](https://semver.org/lang/zh-CN/) è§„èŒƒã€‚

- **ä¸»ç‰ˆæœ¬å·**: ä¸å…¼å®¹çš„APIä¿®æ”¹
- **æ¬¡ç‰ˆæœ¬å·**: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **ä¿®è®¢å·**: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

---

**ç»´æŠ¤è€…**: quying2024  
**é¡¹ç›®åœ°å€**: https://github.com/quying2024/pdf_compressor  
**è®¸å¯è¯**: MIT License
